# lab1 SPOC思考题

## 个人思考题

NOTICE
- 有"w2l2"标记的题是助教要提交到学堂在线上的。
- 有"w2l2"和"spoc"标记的题是要求拿清华学分的同学要在实体课上完成，并按时提交到学生对应的git repo上。
- 有"hard"标记的题有一定的难度，鼓励实现，在4月1日前完成即可。

---

请描述ucore OS配置和驱动外设时钟的准备工作包括哪些步骤？ (w2l2)
- 初始化中断控制器，设置中断描述符表，初始化时钟中断，使能整个系统的中断机制。
```
  + 采分点：说明了ucore OS在让外设时钟正常工作的主要准备工作
  - 答案没有涉及如下3点；（0分）
  - 描述了对IDT的初始化，包了针时钟中断的中断描述符的设置（1分）
  - 除第二点外，进一步描述了对8259中断控制器的初始过程（2分）
  - 除上述两点外，进一步描述了对8253时钟外设的初始化，或描述了对EFLAG操作使能中断（3分）
 ```
- [x]  

>  

lab1中完成了对哪些外设的访问？ (w2l2)
- 时钟，串口，并口，CGA，键盘
 ```
  + 采分点：说明了ucore OS访问的外设
  - 答案没有涉及如下3点；（0分）
  - 说明了时钟（1分）
  - 除第二点外，进一步说明了串口（2分）
  - 除上述两点外，进一步说明了并口，或说明了CGA，或说明了键盘（3分）
 ```
- [x]  

>  

lab1中的cprintf函数最终通过哪些外设完成了对字符串的输出？ (w2l2)
- 串口，并口，CGA
 ```
  + 采分点：说明了cprintf函数用到的3个外设
  - 答案没有涉及如下3点；（0分）
  - 说明了串口（1分）
  - 除第二点外，进一步说明了并口（2分）
  - 除上述两点外，进一步说明了CGA（3分）
 ```
- [x]  

>  

---

## 小组思考题

---

lab1中printfmt函数用到了可变参，请参考写一个小的linux应用程序，完成实现定义和调用一个可变参数的函数。(spoc)
- [x]  
- 使用man va_arg查找到了可变参数的实现和使用方式。需要用到其中的va_start va_arg和va_end函数以及va_list结构体。
- 下面的程序实现了一个可变参的average函数，其中第一个参数是输入数字的个数num，后面的可变参数需要求平均值的数字，函数求出了其中的平均数并返回。

```
#include <stdio.h>
#include <stdarg.h>

double average(int num, ...){
	double sum = 0.0;
	va_list valist;
	
	va_start(valist, num);
	int i = 0;
	for (i = 0; i< num; i++){
		sum += va_arg(valist, int);
	}

	va_end(valist);
	return sum / num;
}

int main(){
	printf("The average: %lf\n", average(4, 2, 3, 4, 5));
	printf("The average: %lf\n", average(3, 1, 2, 3));
}
```



如果让你来一个阶段一个阶段地从零开始完整实现lab1（不是现在的填空考方式），你的实现步骤是什么？（比如先实现一个可显示字符串的bootloader（描述一下要实现的关键步骤和需要注意的事项），再实现一个可加载ELF格式文件的bootloader（再描述一下进一步要实现的关键步骤和需要注意的事项）...） (spoc)
- [x]  
- 先实现一个可显示字符串的bootloader

	初始化寄存器内容
	
	完成实模式到保护模式的转换
	
	在保护模式下通过PIO方式控制串口、并口和CGA等进行字符串输出

- 再实现一个可加载ELF格式文件的bootloader

	bootloader访问硬盘，读取扇区
	
	bootloader可以加载ELF格式文件，是读取ELF Header

- 实现显示函数调用关系的ucore
	
	根据GCC生成的栈构建代码、函数参数压栈约定和实际函数调用过程中的栈结构内存空间，分析并显示函数调用关系
	
- 实现可管理中断并处理中断方式I/O的ucore

	初始化中断，涉及初始化中断控制器8259A（打通外设与CPU的通路）和中断门描述符表（建立外设中断与中断服务例程的联系）和各种外设
	
	中断服务，即收到中断后，实现对中断进行处理的中断服务例程。
> 


如何能获取一个系统调用的调用次数信息？如何可以获取所有系统调用的调用次数信息？请简要说明可能的思路。(spoc)
- [x]  
- Linux系统：直接使用strace指令，或者使用ptrace编程在具体程序中实现。
- uCore系统：可以在内核中系统调用处添加代码直接打印系统调用信息，通过观察lab8_result代码，可以在syscall.c和trap.c中进行相关操作。
> 


如何裁减lab1, 实现一个可显示字符串"THU LAB1"且依然能够正确加载ucore OS的bootloader？如果不能完成实现，请说明理由。
- [x]  

> 

---

## 开放思考题

---

如何修改lab1, 实现在出现除零错误异常时显示一个字符串的异常服务例程的lab1？
- [x]  

> 


在lab1/bin目录下，通过`objcopy -O binary kernel kernel.bin`可以把elf格式的ucore kernel转变成体积更小巧的binary格式的ucore kernel。为此，需要如何修改lab1的bootloader, 能够实现正确加载binar格式的ucore OS？ (hard)
- [x]  

>

GRUB是一个通用的bootloader，被用于加载多种操作系统。如果放弃lab1的bootloader，采用GRU来加载ucore OS，请问需要如何修改lab1, 能够实现此需求？ (hard)
- [x]  

>


如果没有中断，操作系统设计会有哪些问题或困难？在这种情况下，能否完成对外设驱动和对进程的切换等操作系统核心功能？
- [x]  

>  

---
